<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>[译] Netflix 是怎么做以 Notebook 驱动的架构 | 猫尾 と 香辛料 🐾</title>
    <meta name="description" content="樱桃炸弹・蓝莓特攻">
    <meta name="generator" content="VuePress 1.4.0">
    <link rel="icon" href="/logo.png">
  <meta name="theme-color" content="#3eaf7c">
    
    <link rel="preload" href="/assets/css/0.styles.669d5bce.css" as="style"><link rel="preload" href="/assets/js/app.6a2c858f.js" as="script"><link rel="preload" href="/assets/js/1.7be17797.js" as="script"><link rel="preload" href="/assets/js/9.e4b890a3.js" as="script"><link rel="prefetch" href="/assets/js/10.5795f3d1.js"><link rel="prefetch" href="/assets/js/11.238a1e59.js"><link rel="prefetch" href="/assets/js/12.3a1a1131.js"><link rel="prefetch" href="/assets/js/13.148a13a1.js"><link rel="prefetch" href="/assets/js/14.152e4d4e.js"><link rel="prefetch" href="/assets/js/15.c3f8014b.js"><link rel="prefetch" href="/assets/js/16.d83af3f2.js"><link rel="prefetch" href="/assets/js/17.4f1cffe0.js"><link rel="prefetch" href="/assets/js/18.7a453783.js"><link rel="prefetch" href="/assets/js/19.23366ce5.js"><link rel="prefetch" href="/assets/js/20.0a148020.js"><link rel="prefetch" href="/assets/js/21.2f9d07b7.js"><link rel="prefetch" href="/assets/js/22.0a8d5f76.js"><link rel="prefetch" href="/assets/js/23.6e265c6d.js"><link rel="prefetch" href="/assets/js/24.751bfb75.js"><link rel="prefetch" href="/assets/js/25.df987c9d.js"><link rel="prefetch" href="/assets/js/26.76a9f61d.js"><link rel="prefetch" href="/assets/js/27.cde2b02f.js"><link rel="prefetch" href="/assets/js/28.2d4282b8.js"><link rel="prefetch" href="/assets/js/29.285b04b2.js"><link rel="prefetch" href="/assets/js/3.1a07d83c.js"><link rel="prefetch" href="/assets/js/4.882017b7.js"><link rel="prefetch" href="/assets/js/5.08a37a9f.js"><link rel="prefetch" href="/assets/js/6.bceccc0d.js"><link rel="prefetch" href="/assets/js/7.44e0158e.js"><link rel="prefetch" href="/assets/js/8.547ba2f0.js">
    <link rel="stylesheet" href="/assets/css/0.styles.669d5bce.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">猫尾 と 香辛料 🐾</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/post/" class="nav-link router-link-active">
  归档
</a></div><div class="nav-item"><a href="/tag/" class="nav-link">
  标签
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  关于
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/post/" class="nav-link router-link-active">
  归档
</a></div><div class="nav-item"><a href="/tag/" class="nav-link">
  标签
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  关于
</a></div> <!----></nav>  <!----> </aside> <main class="page"><div class="content head"><h1 id="[译] Netflix 是怎么做以 Notebook 驱动的架构">
        [译] Netflix 是怎么做以 Notebook 驱动的架构
      </h1> <div class="tag-links">
  tags:
  <a href="/tag/#翻译" class="tag">
    翻译
  </a><a href="/tag/#Python" class="tag">
    Python
  </a><a href="/tag/#Jupyer" class="tag">
    Jupyer
  </a><a href="/tag/#Notebook" class="tag">
    Notebook
  </a></div></div> <div class="theme-default-content content__default"><blockquote><ul><li>原文地址：<a href="https://blog.goodaudience.com/inside-netflixs-notebook-driven-architecture-aedded32145e" target="_blank" rel="noopener noreferrer">Inside Netflix’s Notebook-Driven Architecture<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>原文作者：<a href="https://twitter.com/jrdothoughts" target="_blank" rel="noopener noreferrer">Denny Headrick<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>译文出自：<a href="https://blog.zthxxx.me/post/inside-netflix-notebook-driven-architecture/" target="_blank" rel="noopener noreferrer">zthxxx's blog<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>译者：<a href="https://github.com/zthxxx" target="_blank" rel="noopener noreferrer">zthxxx<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></blockquote> <p>Jupyter Notebook 是数据科学家库中最强大的工具之一。通常，诸如 Jupyter 或 Zeppelin 等 Notebook 技术用于各种任务，例如数据挖掘，模型测试或数据准备。</p> <p>如果你在一个小型的数据科学家团队，那么使用 Notebook 场景似乎非常有限，但是大型组织运行几十个并行的数据科学工作又如何呢？</p> <p>最近，Netflix 工程团队发布了一系列博客文章，详细的介绍了他们使用  Jupyter Notebook 应用的内部架构。</p> <h2 id="netflix-中的-notebooks"><a href="#netflix-中的-notebooks" class="header-anchor">#</a> Netflix 中的 Notebooks</h2> <p>最初，Netflix 采用 Jupyter Notebook 作为数据挖掘和分析的工具。</p> <p>然而，工程团队很快意识到 Jupyter 在运行时的抽象、可扩展性、代码的可解释性和调试方面提供了明显的优势，如果使用得当，这些优势可能会对数据科学工作效率产生重大影响。</p> <p>为了扩大 Jupyter 作为数据科学分析的使用，Netflix 工程团队需要解决几个主要挑战：</p> <p><img src="/assets/img/notebooks-at-scale.eeb2530d.png" alt="notebooks-at-scale"></p> <ul><li><p><strong>代码-输出不匹配</strong>：Notebooks 经常被修改，很多时候，你在环境中看到的输出与当前代码不对应。</p></li> <li><p><strong>服务器要求</strong>：Notebooks 通常需要运行 Notebook 服务器运行时 (Jupyter)，这在大规模采用时是一个架构挑战。</p></li> <li><p><strong>调度</strong>：大多数数据科学模型需要定期执行，但是用于调度 Notebook 的工具仍然相当有限。</p></li> <li><p><strong>参数化</strong>：Notebooks 是相当静态的代码环境，但输入参数的使用场景又非常繁多。</p></li> <li><p><strong>集成测试</strong>：每个 Notebook 是独立的代码环境，很明显这很难与其他 Notebooks 集成。因此，使用 Notebooks 时，像集成测试这样的任务就是个噩梦。</p></li></ul> <p>为了应对上述一些挑战，Netflix工程团队开始努力为 Jupyter 封装一系列基础架构，以图简化 Notebook 在整个团队中应用的困难。</p> <h2 id="runtime-运行时"><a href="#runtime-运行时" class="header-anchor">#</a> Runtime 运行时</h2> <p>要解决的第一个挑战是创建一个与服务器无关的运行时，支持 Notebook 的参数化执行。</p> <p>Netflix 决定采用 <a href="https://github.com/nteract/papermill" target="_blank" rel="noopener noreferrer">Papermill<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 来实现这一目标。<a href="https://github.com/nteract/papermill" target="_blank" rel="noopener noreferrer">Papermill<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 基于流行的 <a href="https://nteract.io/" target="_blank" rel="noopener noreferrer">nteract<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 库，是一个用于参数化、执行和分析 Jupyter Notebook 的工具。</p> <p>从技术上讲，<a href="https://github.com/nteract/papermill" target="_blank" rel="noopener noreferrer">Papermill<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 接收  Notebook  路径和一些参数输入，然后使用输入执行和渲染请求的 Notebook。当每个单元被执行时，它将产生的结果保存到一个独立输出的 Notebook 中。</p> <p><a href="https://github.com/nteract/papermill" target="_blank" rel="noopener noreferrer">Papermill<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 的另一个好处是能够将 Notebook 的输出存储在不同的存储格式中。</p> <p>以 Netflix 为例在，团队决定将任何 Notebook 执行的结果输出到由 <a href="https://github.com/nteract/nteract/tree/master/applications/commuter" target="_blank" rel="noopener noreferrer">Commuter<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 管理的 S3 bucket 中；</p> <p><a href="https://github.com/nteract/nteract/tree/master/applications/commuter" target="_blank" rel="noopener noreferrer">Commuter<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 是另一个基于 <a href="https://nteract.io/" target="_blank" rel="noopener noreferrer">nteract<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 的平台，包括用于查找 Notebook 的资源浏览器，并提供了兼容 Jupyter 版本的内容 API。</p> <p>从高层次来看，Netflix 笔记本架构开始看起来如下图所示：</p> <p><img src="/assets/img/notebook-architecture.935379d0.png" alt="img"></p> <h2 id="调度"><a href="#调度" class="header-anchor">#</a> 调度</h2> <p>Netflix 工程团队需要解决的另一个关键挑战是创建基础架构，以便能够定期执行 Notebook。</p> <p>在引入 Papermill 之后，这一挑战变得相对容易解决，因为这个架构本质上将参数化执行与调度分离，这意味着它可以与不同的调度器模型配合使用。</p> <p>Netflix 团队决定将他们的 Notebooks 与他们自己的调度框架 <a href="https://medium.com/netflix-techblog/meson-workflow-orchestration-for-netflix-recommendations-fc932625c1d9" target="_blank" rel="noopener noreferrer">Meson<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 集成。从技术上讲，<a href="https://medium.com/netflix-techblog/meson-workflow-orchestration-for-netflix-recommendations-fc932625c1d9" target="_blank" rel="noopener noreferrer">Meson<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 是一个通用的工作流程编排和调度框架，用于跨异步系统执行 ML 管道。</p> <p>这一过程的架构相对简单，如下图所示：</p> <p><img src="/assets/img/notebook-and-docker.750383a9.png" alt="notebook-and-docker"></p> <h2 id="集成测试"><a href="#集成测试" class="header-anchor">#</a> 集成测试</h2> <p>为了在 Noteboo k架构中自动化集成测试，Netflix 采用了 <a href="https://github.com/nteract/papermill" target="_blank" rel="noopener noreferrer">Papermill<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 的多输出功能。本质上，集成测试是另一个Notebook，输出成为目标 Notebook 的输入。</p> <p><img src="/assets/img/notebook-to-testing.ca31d2af.png" alt="notebook-to-testing"></p> <p>Netflix 的架构是我见过的大规模使用 Jupyter Notebook 最先进的基础设施之一。在这种架构中实现的大多数模式都基于开源工具，并且可以被刚开始进行数据科学之旅的团队轻松使用。</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/zthxxx/zthxxx.github.io/edit/master/source/_posts/20181105-inside-netflix-notebook-driven-architecture.md" target="_blank" rel="noopener noreferrer">Edit on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2020-01-05 06:23</span></div></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.6a2c858f.js" defer></script><script src="/assets/js/1.7be17797.js" defer></script><script src="/assets/js/9.e4b890a3.js" defer></script>
  </body>
</html>
